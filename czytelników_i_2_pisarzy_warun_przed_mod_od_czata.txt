#dodanie bibliotek

int const max_pisz=2;
//deklaracje zmiennych

int ile_czyt = 0;
pthread_cond_t ile_czyta = PTHREAD_COND_INITIALIZER;
pthread_mutex_t czytanie = PTHREAD_MUTEX_INITIALIZER;

int ile_pisz = 0
pthread_cond_t ile_pisze = PTHREAD_COND_INITIALIZER;
pthread_mutex_t pisanie = PTHREAD_MUTEX_INITIALIZER;

pthread_cond_t pisz = PTHREAD_COND_INITIALIZER;
pthread_mutex_t pisanieZew = PTHREAD_MUTEX_INITIALIZER;


void monitor()
{
        FILE *log = fopen("access_log.txt", "a");
        time_t now;
        time(&now);
        fprintf(log, "[%.19s] Aktywni pisarze: %d; Aktywni czytelnicy: %d\n", ctime(&now), ile_czyta, ile_pisze);
        fclose(log);
}

//procedury procesów
void pisarz()
{
        while (1)
        {
                //oczekiwanie na brak czytelników?
                pthread_mutex_lock(&pisanieZew);
                while (ile_czyt > 0)
                {
                        pthread_cond_wait(&ile_czyta, &pisanieZew);
                }
                pthread_mutex_unlock(&pisanieZew);

                //Blokowanie jeśli ile_pisz > 2
                pthread_mutex_lock(&pisanie);
                while (ile_pisz >= max_pisz)
                {
                        pthread_cond_wait(&ile_pisze, &pisanie);
                }
                ile_pisz++;//blokowanie czytelników

                monitor();



                writeZrodlo();            // Odbywa się pisanie

                pthread_mutex_lock(&pisanie);
                ile_pisz--;
                pthread_cond_signal(&ile_pisze);
                pthread_mutex_unlock(&pisanie);
                if (ile_pisz==0)
                {
                        //odblokuj czytelników
                }
        }
}


void czytelnik()
{
        while (1)
        {
                //oczekiwanie na brak pisarzy
                pthread_mutex_lock(&czytanie);
                while (ile_pisz > 0)
                {
                        pthread_cond_wait(&ile_czyta, &czytanie);
                }
                pthread_mutex_unlock(&czytanie);
                //blokowanie pisarzy
                ile_czyt++;

                readzrodlo();           //odbywa się czytanie

                //odblokowywanie pisarzy

                ile_czyt--;
                if (ile_czyt == 0)
                {
                        pthread_cond_signal(&ile_pisze, &pisanie);
                }
        }
}



"główna część":
{
        alokuj tabliceWątków

        for (int i = 0; i < ile_czytaczy; i++)
        {
                stwórz wątekCzyt;//przypisując do niego funkcję
        }
        for (int i = 0; i < ile_pisarzy; i++)
        {
                stwórz wątekPisz;//przypisując do niego funkcję
        }
        //uruchomienie procesów
        for (int i = 0; i < ile_czytaczy; i++)
        {
                uruchom(wątekCzyt);
        }
        for (int i = 0; i < ile_pisarzy; i++)
        {
                uruchom(wątekPisz);
        }

        zwolnienie(tabliceWątków);
        zniszczenie(pisanie);
        zniszczenie(pisanieZew);
        zniszczenie(czytanie);
}